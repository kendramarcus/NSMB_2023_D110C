# NSMB_2023_D110C
Code used for DMS analysis in the publication "Autoinhibition of a clamp-loader ATPase revealed by deep mutagenesis and cryo-EM"

==========================
For the raw sequencing data of all deep mutational scanning experiments, please refer to BioProject PRJNA1025274

File types:

fasta.gz files (downloaded from Bioproject PRJNA1025274) - paired end reads of clamp loader sequences obtained directly from the Illumina Miseq instrument. The file names include the data type (input or selected replicate, 'rep#'), index number (70x-50x), and paired-end read direction (R1 or R2)
 
FLASH- a program used to identify and join together the paired end reads and generate single reads of the DNA sequences. Please see "FLASH: Fast length adjustment of short reads to improve genome assemblies. T. Magoc and S. Salzberg. Bioinformatics 27:21 (2011), 2957-63."
https://ccb.jhu.edu/software/FLASH/

.fasta files- joined DNA sequences from the paired end data as generated by FLASH. These files are omitted from the drive folder to conserve space, but can be obtained by request. FLASH is included in this drive so the joined .fasta files can be reconstructed.

counter.sh files- bash scripts used to count instances of a given clamp loader variant from joined DNA sequences. This script is a simple grep command that counts instances of specific sequences within the fasta file. The order of the sequences counter starts at the beginning of the variant region (codon 2 in pool A and codon 117 in pool B) and iterates codon variants [AAG, CGC, CGG, AGG, GAG, GAC, AAC, CAG, CAC, ACC, ACG, AGC, TCC, TCG, TGC, GCC, GCG, GTC, GTG, CTC, CTG, TTG, ATC, ATG, TTC, TAC, TGG, GGC, GGG, CCC, CCG, TAG]. When this codon list is exhausted for a particular position, the next position in the sequence becomes the variable codon until the entire library is accounted for. All sequences pulled out of the raw data contain the D110C mutation.

For pool A, a synonymous codon mutation was located in the gp44 gene (GCC to GCT at position 27, both encoding alanine). The counter script for pool A counts both WT (GCC) and variant (GCT) versions of the sequence. Thus, the count list generated will be twice the size. Counts of D110C variants were added together between these two lists.

================

Protocol for generating count data from .gz files

1) FLASH is performed on *_R1.fasta.gz and *_R2.fasta.gz files of the same index (70x_50x) as follows:

./FLASH *_R1.fasta.gz, *_R2.fasta.gz -o [index]_joined.fasta -M 100

2) The fasta files generated are then used to generate count instances via the bash scripts as follows: 

./counter.sh

The count scripts were updated just prior to running to change the output file name and input files (joined .fasta) 

3) The output files of this script are .txt lists of counts per sequence searched. The order of the lists correspond to the order of mutants accounted for in each .xls sheet (see CompiledCountData_2023.xls)

Please note that only the forward reads were used for P50NNS and S35NNS counting and the reverse read of the G143NNS data was used. 


=================== 

Protocol for obtaining fitness values from count data 

fitnesses were calculated and visualized in Matlab. However, any data processing software can be used as follows:

1) A matrix of count data (as seen in each sheet of the CompiledCountData_KM_YH_JK_2023.xls file) is copied to Matlab (or other software)

2) The log value of each value in the matrix is calculated and saved as a new matrix
	Command in Matlab: logcounts = log10(rawcounts)

3) The first column of the matrix (input counts) is subtracted against the other columns in the matrix (selected population) and saved as a new matrix (non normalized fitnesses)
	Command in Matlab: fitness=logcounts-repmat(logcounts(:,1),1,4);

4) The non-normalized matrix is modified to be normalized to the reference allele to generate the normalized fitness matrix containing redundant, or synonymous codons. 
	Command in Matlab: normfitnessinput=fitness-repmat(fitness([referenceallelelocation],:),[n positions],1);

5) This matrix was then copied to excel and synonymous codon fitness values were averaged together. Positions with input counts of less than 10 were omitted from the fitness list as a value of "NaN". fitness values unable to be generated due to no counts in the selected population, but >10 counts in the input population were corrected to have the minimum fitness value of -3. 

6) A final matrix of mutant fitnesses was constructed for each library as a ~120x21 matrix for pools A and B by averaging the two trials per pool. This matrix is used to generate a heatmap for data representation. 

=====================

Protocol for generating heatmap from fitness values

The heatmap of fitness values was generated using Matlab using a color gradient provided as 'newCmap.txt', also located in this drive folder. To generate the heatmap using Matlab, the following commands were used:

h= imshow(normalizedmatrixname,[-3 3],'initialmagnification','fit');
colormap(newCmap)
set(gca,'ytick',1:1:21,'YTickLabel',aa);
set(gca, 'xtick',1:1:114, 'XTickLabel',Xaxis2);
axis on
set(gca,'color','0.7,0.7,0.7')
set(h,'alphadata',~isnan(normalizedmatrixname))

Where 'aa' was the Y axis values 'KREDNQHTSCAVLIMFYWGP*'
And 'Xaxis2' is the clamp loader sequence 
